{% extends 'layouts/base-presentation.html' %}

{% block title %} Worker details {% endblock title %}

{% block content %}
    <div class="container" style="margin-top: 100px">
        <h1 class="text-primary">
            Worker: {{ worker.username }}
            <button type="button" class="btn bg-gradient-primary w-auto mb-0" data-bs-toggle="modal"
                    data-bs-target="#exampleModal">
                Delete worker
            </button>
        </h1>
        <hr>
        <p><strong>First name:</strong> {{ worker.first_name }}</p>
        <p><strong>Last name:</strong> {{ worker.last_name }}</p>
        <p>
            <strong>Position:</strong> {{ worker.position }}
        </p>
        <div class="row">
            <div class="col-12">
                <div class="card mb-4">
                    <div class="card-header pb-0">
                        <h3 class="text-primary">Tasks to be completed</h3>
                    </div>
                    {% if worker.tasks.all %}
                        <table class="table table-hover">
                        <thead style="background: #F1F1F1; border-radius: 2rem">
                        <colgroup>
                            <col style="width: 16%"/>
                            <col style="width: 16%"/>
                            <col style="width: 16%"/>
                            <col style="width: 16%"/>
                            <col style="width: 16%"/>
                            <col style="width: 16%"/>
                        </colgroup>
                        <tr>
                            <th>Task</th>
                            <th>Description</th>
                            <th>Task type</th>
                            <th>Priority</th>
                            <th>Status</th>
                            <th>Change status</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for task in worker.tasks.all %}
                            {% if not task.is_completed %}
                                <tr>
                                    <td>{{ task.name }}</td>
                                    <td>
                                        <button type="button" class="btn bg-gradient-secondary mb-0"
                                                data-bs-container="body"
                                                data-bs-toggle="popover" data-bs-placement="top"
                                                data-bs-content-id="popover-content{{ task.id }}">
                                            üìù
                                        </button>
                                        <div id="popover-content{{ task.id }}" class="d-none">
                                            {{ task.description }}
                                        </div>
                                    </td>
                                    <td>{{ task.task_type }}</td>
                                    <td>
                                        {% if task.priority == 1 %}
                                            <span class="badge bg-gradient-danger">{{ task.get_priority_display }}</span>
                                        {% elif task.priority == 2 %}
                                            <span class="badge bg-gradient-dark">{{ task.get_priority_display }}</span>
                                        {% elif task.priority == 3 %}
                                            <span class="badge bg-gradient-secondary">{{ task.get_priority_display }}</span>
                                        {% elif task.priority == 4 %}
                                            <span class="badge bg-gradient-light text-dark">{{ task.get_priority_display }}</span>
                                        {% endif %}
                                    </td>
                                    <td>Not done</td>
                                    <td><a href="{% url 'home:change-task-status' pk1=task.id pk2=worker.id %}"
                                           class="btn bg-gradient-primary w-auto me-1 mb-0">
                                        Complete
                                    </a></td>
                                </tr>
                            {% endif %}
                        {% endfor %}
                    {% else %}
                        <p>ALL DONE! RELAX :)</p>
                    {% endif %}
                    </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-12">
                <div class="card mb-4">
                    <div class="card-header pb-0">
                        <h3 class="text-primary">Completed tasks</h3>
                    </div>
                    {% if worker.tasks.all %}
                        <table class="table table-hover">
                        <thead style="background: #F1F1F1">
                        <colgroup>
                            <col style="width: 16%"/>
                            <col style="width: 16%"/>
                            <col style="width: 16%"/>
                            <col style="width: 16%"/>
                            <col style="width: 16%"/>
                            <col style="width: 16%"/>
                        </colgroup>
                        <tr>
                            <th>Task</th>
                            <th>Description</th>
                            <th>Task type</th>
                            <th>Priority</th>
                            <th>Status</th>
                            <th>Change status</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for task in worker.tasks.all %}
                            {% if task.is_completed %}
                                <tr>
                                    <td>{{ task.name }}</td>
                                    <td>
                                        <button type="button" class="btn bg-gradient-secondary mb-0"
                                                data-bs-container="body"
                                                data-bs-toggle="popover" data-bs-placement="top"
                                                data-bs-content-id="popover-content{{ task.id }}">
                                            üìù
                                        </button>
                                        <div id="popover-content{{ task.id }}" class="d-none">
                                            {{ task.description }}
                                        </div>
                                    </td>
                                    <td>{{ task.task_type }}</td>
                                    <td>
                                        {% if task.priority == 1 %}
                                            <span class="badge bg-gradient-danger">{{ task.get_priority_display }}</span>
                                        {% elif task.priority == 2 %}
                                            <span class="badge bg-gradient-dark">{{ task.get_priority_display }}</span>
                                        {% elif task.priority == 3 %}
                                            <span class="badge bg-gradient-secondary">{{ task.get_priority_display }}</span>
                                        {% elif task.priority == 4 %}
                                            <span class="badge bg-gradient-light text-dark">{{ task.get_priority_display }}</span>
                                        {% endif %}
                                    </td>
                                    <td>Done</td>
                                    <td><a href="{% url 'home:change-task-status' pk1=task.id pk2=worker.id %}"
                                           class="btn bg-gradient-secondary w-auto me-1 mb-0">
                                        Undo
                                    </a></td>
                                </tr>
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                    </tbody>
                    </table>
                </div>
            </div>
        </div>
        <!-- Modal -->
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">DELETE WORKER</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        Are you sure you want to remove <strong>{{ worker.username }}</strong> from the list of workers?
                    </div>
                    <div class="modal-footer justify-content-between">
                        <button type="button" class="btn bg-gradient-dark" data-bs-dismiss="modal">No</button>
                        <a href="{% url "home:worker-delete" pk=worker.id %}" class="btn bg-gradient-primary">Yes</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    <script>
        const list = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'))
        list.map((el) => {
            let opts = {
                animation: false,
            }
            if (el.hasAttribute('data-bs-content-id')) {
                opts.content = document.getElementById(el.getAttribute('data-bs-content-id')).innerHTML;
                opts.html = true;
            }
            new bootstrap.Popover(el, opts);
        })
    </script>
{% endblock javascripts %}
